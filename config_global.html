<?php

if (!isset($CFG->block_dashboard_extra_db_host)){
    set_config('block_dashboard_extra_db_host', '');
}

if (!isset($CFG->block_dashboard_extra_db_port)){
    set_config('block_dashboard_extra_db_port', '');
}

if (!isset($CFG->block_dashboard_extra_db_db)){
    set_config('block_dashboard_extra_db_db', '');
}

if (!isset($CFG->block_dashboard_extra_db_user)){
    set_config('block_dashboard_extra_db_user', '');
}

if (!isset($CFG->block_dashboard_extra_db_password)){
    set_config('block_dashboard_extra_db_password', '');
}

if (!isset($CFG->block_dashboard_big_result_threshold)){
    set_config('block_dashboard_big_result_threshold', 500);
}

if (!isset($CFG->block_dashboard_enable_isediting_security)){
    set_config('block_dashboard_enable_isediting_security', 0);
}

if (!isset($CFG->block_dashboard_output_line_separator)){
    set_config('block_dashboard_output_line_separator', "LF");
}

if (!isset($CFG->block_dashboard_output_field_separator)){
    set_config('block_dashboard_output_field_separator', ";");
}

if (!isset($CFG->block_dashboard_output_encoding)){
    set_config('block_dashboard_output_encoding', "UTF-8");
}

if (!isset($CFG->block_dashboard_cron_hour)){
    set_config('block_dashboard_cron_hour', '');
}

if (!isset($CFG->block_dashboard_cron_min)){
    set_config('block_dashboard_cron_min', '');
}

if (!isset($CFG->block_dashboard_cron_enabled)){
    set_config('block_dashboard_cron_enabled', 0);
}

if (!isset($CFG->block_dashboard_cron_freq)){
    set_config('block_dashboard_cron_freq', 'daily');
}

?>
<div style="text-align:center;">
<fieldset>
<legend><?php print_string('extradbparams', 'block_dashboard') ?></legend>
<table cellspacing="5">
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('dashboard_extra_db_host', 'block_dashboard') ?>:</b>
        </td>
        <td valign="top" align="left">
                <input type="text" name="block_dashboard_extra_db_host" value="<?php echo $CFG->block_dashboard_extra_db_host; ?>" />
            <br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('dashboard_extra_db_port', 'block_dashboard') ?>:</b>
        </td>
        <td valign="top" align="left">
                <input type="text" name="block_dashboard_extra_db_port" value="<?php echo $CFG->block_dashboard_extra_db_port; ?>" />
            <br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('dashboard_extra_db_db', 'block_dashboard') ?>:</b>
        </td>
        <td valign="top" align="left">
                <input type="text" name="block_dashboard_extra_db_db" value="<?php echo $CFG->block_dashboard_extra_db_db; ?>" />
            <br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('dashboard_extra_db_user', 'block_dashboard') ?>:</b>
        </td>
        <td valign="top" align="left">
                <input type="text" name="block_dashboard_extra_db_user" value="<?php echo $CFG->block_dashboard_extra_db_user; ?>" />
            <br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('dashboard_extra_db_password', 'block_dashboard') ?>:</b>
        </td>
        <td valign="top" align="left">
                <input type="password" name="block_dashboard_extra_db_password" value="<?php echo $CFG->block_dashboard_extra_db_password; ?>" />
            <br/>
        </td>
    </tr>
</table>
</fieldset>

<fieldset>
<legend><?php print_string('securityparams', 'block_dashboard') ?></legend>
<table cellspacing="5">
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('dashboard_big_result_threshold', 'block_dashboard') ?>:</b>
        </td>
        <td valign="top" align="left">
                <input type="text" name="block_dashboard_big_result_threshold" value="<?php echo $CFG->block_dashboard_big_result_threshold; ?>" />
            <br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('dashboard_enable_isediting_security', 'block_dashboard') ?>:</b>
        </td>
        <td valign="top" align="left">
                <input type="text" name="block_dashboard_enable_isediting_security" value="<?php echo $CFG->block_dashboard_enable_isediting_security; ?>" />
            <br/>
        </td>
    </tr>
</table>
</fieldset>

<fieldset>
<legend><?php print_string('datarefresh', 'block_dashboard') ?></legend>
<table cellspacing="5">
    <tr>
        <td valign="top" align="right" style="line-height:1.6em">
            <b><?php print_string('dashboard_cron_enabled', 'block_dashboard') ?>:</b><br/>
            <b><?php print_string('dashboard_cron_hour', 'block_dashboard') ?>:</b><br/>
            <b><?php print_string('dashboard_cron_min', 'block_dashboard') ?>:</b><br/>
            <b><?php print_string('dashboard_cron_freq', 'block_dashboard') ?>:</b><br/>
        </td>
        <td valign="top" align="left" style="line-height:1.5em">
        	<?php 
        	$enabledcheck = ($CFG->block_dashboard_cron_enabled) ? " checked=\"checked\" " : '' ;
        	?>
            <input type="checkbox" name="block_dashboard_cron_enabled" value="1" <?php echo $enabledcheck ?> /> <?php print_string('enabled', 'block_dashboard') ?>
            <br/><input type="text" name="block_dashboard_cron_hour" size="2" maxlength="2" value="<?php echo $CFG->block_dashboard_cron_hour; ?>" />
            <br/><input type="text" name="block_dashboard_cron_min" size="2" maxlength="2" value="<?php echo $CFG->block_dashboard_cron_min; ?>" />
            <?php 
			$freq['daily'] = get_string('daily', 'block_dashboard');
			$freq['0'] = get_string('sunday', 'block_dashboard');
			$freq['1'] = get_string('monday', 'block_dashboard');
			$freq['2'] = get_string('tuesday', 'block_dashboard');
			$freq['3'] = get_string('wednesday', 'block_dashboard');
			$freq['4'] = get_string('thursday', 'block_dashboard');
			$freq['5'] = get_string('friday', 'block_dashboard');
			$freq['6'] = get_string('saturday', 'block_dashboard');
			echo '<br/>';
            choose_from_menu($freq, 'block_dashboard_cron_freq', $CFG->block_dashboard_cron_freq, '');
            ?>
        </td>
    </tr>
</table>
</fieldset>

<fieldset>
<legend><?php print_string('outputfilegeneration', 'block_dashboard') ?></legend>
<table cellspacing="5">
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('dashboard_output_field_separator', 'block_dashboard') ?>:</b>
        </td>
        <td valign="top" align="left">
        	<?php 
        	$fieldseps[","] = ',';
        	$fieldseps[";"] = ';';
        	$fieldseps["TAB"] = "Tab";
        	choose_from_menu($fieldseps, 'block_dashboard_output_field_separator', $CFG->block_dashboard_output_field_separator); ?>
            <br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('dashboard_output_line_separator', 'block_dashboard') ?>:</b>
        </td>
        <td valign="top" align="left">
        	<?php 
        	$lineseps["LF"] = 'LF';
        	$lineseps["CR"] = 'CR';
        	$lineseps["CRLF"] = 'CRLF';
        	choose_from_menu($lineseps, 'block_dashboard_output_line_separator', $CFG->block_dashboard_output_line_separator); ?>
            <br/>
        </td>
    </tr>
    <tr>
        <td valign="top" align="right">
            <b><?php print_string('dashboard_output_encoding', 'block_dashboard') ?>:</b>
        </td>
        <td valign="top" align="left">
        	<?php 
        	$encodings['UTF-8'] = 'UTF-8';
        	$encodings['ISO-8859-1'] = 'ISO-8859-1';
        	$encodings['ASCII'] = 'ASCII';
        	choose_from_menu($encodings, 'block_dashboard_output_encoding', $CFG->block_dashboard_output_encoding); 
        	?>
            <br/>
        </td>
    </tr>
</table>
</fieldset>

<table cellspacing="5">
    <tr>
        <td valign="top" align="right" colspan="2">
            <input type="submit" value="<?php print_string('savechanges'); ?>" />
        </td>
    </tr>
</table>
</div>
